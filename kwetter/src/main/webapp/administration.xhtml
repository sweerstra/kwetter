<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html
        PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:f="http://java.sun.com/jsf/core"
      xmlns:p="http://primefaces.org/ui">

<h:head>
    <title>User Overview</title>
    <h:outputStylesheet name="css/style.css"/>
    <h:outputStylesheet name="css/administration.css"/>
</h:head>

<h:body>
    <div class="administration">
        <div class="users__list">
            <div class="administration__users__header">
                <h1>Users</h1>

                <h:form id="user-form">
                    <p:growl id="add-user" showDetail="true"/>

                    <p:inputText type="text" value="#{userBean.username}" placeholder="Username"/>
                    <p:inputText type="password" value="#{userBean.password}" placeholder="Password"/>
                    <p:selectOneMenu value="#{userBean.role}" style="width:125px">
                        <f:selectItem itemLabel="User" itemValue="USER"/>
                        <f:selectItem itemLabel="Moderator" itemValue="MODERATOR"/>
                        <f:selectItem itemLabel="Administrator" itemValue="ADMINISTRATOR"/>
                    </p:selectOneMenu>

                    <p:commandButton value="Add" update="@all"
                                     actionListener="#{usersBean.addUser(userBean.username, userBean.password, userBean.role)}"/>
                </h:form>
            </div>

            <h:form id="users-form">
                <p:growl id="role-update" showDetail="true"/>

                <p:dataTable var="user" editable="true" editMode="cell" selectionMode="single" rowKey="#{user.id}"
                             value="#{usersBean.users}">
                    <p:ajax event="cellEdit" listener="#{usersBean.onCellEdit}" update=":users-form:role-update"/>
                    <p:ajax event="rowSelect" listener="#{kweetsBean.onUserRowSelect}"
                            update="@all"/>

                    <p:column headerText="Id">
                        <h:outputText value="#{user.id}"/>
                    </p:column>

                    <p:column headerText="Username">
                        <h:outputText value="#{user.username}"/>
                    </p:column>

                    <p:column headerText="Role">
                        <p:cellEditor>
                            <f:facet name="output"><h:outputText value="#{user.role}"/></f:facet>
                            <f:facet name="input">
                                <h:selectOneMenu style="width:100%" value="#{user.role}">
                                    <f:selectItem itemLabel="User" itemValue="USER"/>
                                    <f:selectItem itemLabel="Moderator" itemValue="MODERATOR"/>
                                    <f:selectItem itemLabel="Administrator" itemValue="ADMINISTRATOR"/>
                                </h:selectOneMenu>
                            </f:facet>
                        </p:cellEditor>
                    </p:column>
                </p:dataTable>
            </h:form>
        </div>

        <div class="kweets__list">
            <div class="administration__kweets__header">
                <h1>Kweets</h1>
            </div>

            <h:form id="kweets-form">
                <p:growl id="username-update" showDetail="true"/>

                <p:dataTable id="kweets-datatable" var="kweet" editable="true" editMode="cell"
                             value="#{kweetsBean.kweets}">
                    <p:ajax event="cellEdit" listener="#{kweetsBean.onTextCellEdit}"
                            update=":kweets-form:username-update"/>

                    <p:column headerText="Id">
                        <h:outputText value="#{kweet.id}"/>
                    </p:column>

                    <p:column headerText="Text">
                        <p:cellEditor>
                            <f:facet name="output"> <h:outputText value="#{kweet.text}"/></f:facet>
                            <f:facet name="input"><p:inputText value="#{kweet.text}"/></f:facet>
                        </p:cellEditor>
                    </p:column>

                    <p:column headerText="User">
                        <h:outputText value="#{kweet.user.username}"/>
                    </p:column>

                    <p:column headerText="Date">
                        <h:outputText value="#{kweet.date.toLocaleString()}"/>
                    </p:column>

                    <p:column>
                        <p:commandButton value="Remove" actionListener="#{kweetsBean.removeKweet(kweet)}"
                                         style="width: 100%;" ajax="false"/>
                    </p:column>
                </p:dataTable>
            </h:form>
        </div>
    </div>
</h:body>

</html>